<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pawtopia é¤Šç‹—éŠæˆ²ï¼ˆä¿®æ­£ç‰ˆï¼‰</title>
<style>
body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background: #f6f3ff; margin: 0; padding: 20px; }
.container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 6px 18px rgba(20,20,40,0.06);} 
.stats, .actions, .mission, .log { margin-top: 20px; }
.bar { height: 14px; background: #eee; border-radius: 8px; overflow: hidden; margin-top: 4px; }
.fill { height: 100%; background: #4caf50; transition: width 300ms ease; }
button { padding: 8px 16px; margin-right: 8px; border: none; border-radius: 8px; cursor: pointer; background:#2563eb; color:white; }
.secondary { background:#10b981; }
.mission li { background: #f3f3f3; padding: 10px; border-radius: 8px; margin-bottom: 6px; display: flex; justify-content: space-between; }
.log ul { max-height: 160px; overflow-y: auto; padding-left: 16px; }
.meta { display:flex; gap:12px; align-items:center; }
.small { font-size:0.9rem; color:#555; }
.levelbox { background:#fef3c7; padding:6px 10px; border-radius:8px; }
.xpbox { background:#eef2ff; padding:6px 10px; border-radius:8px; }
/* æ–°çš„ä¸€å¤©å‹•ç•« */
.day-transition { 
  animation: dayFlash 0.8s ease;
}
@keyframes dayFlash {
  0% { background-color: #fffabf; }
  100% { background-color: transparent; }
}
</style>
</head>
<body>
<div class="container">
  <h1>Pawtopiaï¼ˆHTML ç‰ˆ â€¢ ä¿®æ­£ç‰ˆï¼‰</h1>

  <!-- å–åå€ -->
  <div id="namingArea">
    <h2>æ›¿ä½ çš„ç‹—ç‹—å–åå­—</h2>
    <input id="dogNameInput" placeholder="è¼¸å…¥åå­—" />

    <h3>é¸æ“‡ä½ çš„ç‹—ç‹—å¤–è§€</h3>
    <div style="display:flex; gap:12px; margin:10px 0;">
      <img src="https://place-puppy.com/200x200" data-dog="https://place-puppy.com/200x200" class="dogChoice" style="width:80px; height:80px; border-radius:8px; cursor:pointer; border:3px solid transparent;">
      <img src="https://place-puppy.com/201x201" data-dog="https://place-puppy.com/201x201" class="dogChoice" style="width:80px; height:80px; border-radius:8px; cursor:pointer; border:3px solid transparent;">
      <img src="https://place-puppy.com/202x202" data-dog="https://place-puppy.com/202x202" class="dogChoice" style="width:80px; height:80px; border-radius:8px; cursor:pointer; border:3px solid transparent;">
    </div>

    <button id="startBtn">é–‹å§‹éŠæˆ²</button>
  </div>

  <!-- ä¸»éŠæˆ²å€ -->
  <div id="gameArea" style="display:none;">
    <div class="meta">
      <h2 id="dogTitle"></h2>
      <div class="levelbox">ç­‰ç´šï¼š<span id="dogLevel">1</span></div>
      <div class="xpbox">XPï¼š<span id="xpDisplay">0 / 3</span></div>
      <div class="small" id="dayDisplay">ç¬¬ 1 å¤©</div>
    </div>

    <img id="mainDogImg" src="https://place-puppy.com/200x200" alt="dog" style="border-radius:12px; margin-top:12px;" />

    <!-- ç‹€æ…‹åˆ— -->
    <div class="stats">
      <div>å¿«æ¨‚ï¼š<span id="happyValue">70</span>%
        <div class="bar"><div id="happyBar" class="fill" style="width:70%"></div></div>
      </div>
      <div>é£½è¶³æ„Ÿï¼š<span id="hungerValue">30</span>%
        <div class="bar"><div id="hungerBar" class="fill" style="width:30%"></div></div>
      </div>
      <div>èƒ½é‡ï¼š<span id="energyValue">60</span>%
        <div class="bar"><div id="energyBar" class="fill" style="width:60%"></div></div>
      </div>
    </div>

    <!-- æŒ‰éˆ• -->
    <div class="actions">
      <button id="feedBtn">é¤µé£Ÿ</button>
      <button id="playBtn">ç©è€</button>
      <button id="sleepBtn">ç¡è¦º</button>
    </div>

    <!-- ä»»å‹™ -->
    <div class="mission">
      <h3>ä»Šæ—¥ä»»å‹™</h3>
      <ul>
        <li>é¤µé£Ÿ <span id="missionFeed">0/1</span></li>
        <li>ç©è€ <span id="missionPlay">0/2</span></li>
      </ul>
      <p>å·²å®Œæˆä»»å‹™æ¬¡æ•¸ï¼ˆç”¨æ–¼å‡ç´šï¼‰ï¼š<span id="missionTotal">0</span></p>
    </div>

    <!-- æ—¥èªŒ -->
    <div class="log">
      <h3>æ—¥èªŒ</h3>
      <ul id="logList"></ul>
    </div>
  </div>
</div>

<script>
// --- Game state ---
const dog = {
  name: '',
  happiness: 70,
  hunger: 30,
  energy: 60,
  level: 1
};
let xp = 0;
const xpToLevelUp = 3; // 3 XP to level up
const xpPerMission = 1; // 1 mission = +1 XP

let day = 1;
let actionCount = 0;

// Today's mission targets (randomized each day)
let mission = {
  feedTarget: 1, // we'll display as n / target
  playTarget: 2,
  feedDone: 0,
  playDone: 0,
  completedCount: 0 // how many times player completed full mission (for XP awarding shown in missionTotal)
};

// --- Helpers ---
function el(id){ return document.getElementById(id); }
function log(msg){ const ul = el('logList'); const li = document.createElement('li'); li.textContent = msg; ul.prepend(li); }

// --- UI updates ---
function updateStatsUI(){
  el('happyValue').textContent = dog.happiness;
  el('hungerValue').textContent = dog.hunger;
  el('energyValue').textContent = dog.energy;
  el('happyBar').style.width = dog.happiness + '%';
  el('hungerBar').style.width = dog.hunger + '%';
  el('energyBar').style.width = dog.energy + '%';
}

function updateMissionUI(){
  el('missionFeed').textContent = `${mission.feedDone}/${mission.feedTarget}`;
  // mission requires 2 plays to count, but we show current/target as 0/2 by default
  el('missionPlay').textContent = `${mission.playDone}/${mission.playTarget}`;
  el('missionTotal').textContent = mission.completedCount;
}

function updateMetaUI(){
  el('dogLevel').textContent = dog.level;
  el('xpDisplay').textContent = `${xp} / ${xpToLevelUp}`;
  el('dayDisplay').textContent = `ç¬¬ ${day} å¤©`;
}

function checkWarnings(){
  if (dog.happiness <= 0) alert('âš ï¸ ç‹—ç‹—å¤ªä¸é–‹å¿ƒäº†ï¼');
  if (dog.hunger <= 0) alert('âš ï¸ ç‹—ç‹—å¤ªé¤“äº†ï¼');
  if (dog.energy <= 0) alert('âš ï¸ ç‹—ç‹—æ²’æœ‰åŠ›æ°£äº†ï¼');
}

// --- Mission generation ---
function generateNewMission(){
  // total mission count = 5, split randomly between feed and play
  const feed = Math.floor(Math.random() * 4) + 1; // 1~4
  const play = 5 - feed; // ensures total = 5
  mission.feedTarget = feed;
  mission.playTarget = play;
  mission.feedDone = 0;
  mission.playDone = 0;
  updateMissionUI();
}

// --- Actions ---
function afterAction(){
  actionCount++;
  updateStatsUI();
  updateMissionUI();
  updateMetaUI();
  checkWarnings();
  if (actionCount >= 10) {
    startNewDay();
  }
}

function feed(){
  // feeding reduces hunger, increases happiness
  dog.hunger = Math.min(100, dog.hunger + 20);
  dog.happiness = Math.min(100, dog.happiness + 10);
  mission.feedDone++;
  log('ä½ é¤µäº†ç‹—ç‹—ã€‚');
  checkMissionCompletion();
  afterAction();
}

function play(){
  // playing increases happiness but reduces energy
  dog.happiness = Math.min(100, dog.happiness + 15);
  dog.energy = Math.max(0, dog.energy - 20);
  mission.playDone++;
  log('ä½ å’Œç‹—ç‹—ç©è€ï¼');
  checkMissionCompletion();
  afterAction();
}

function sleepDog(){
  dog.energy = Math.min(100, dog.energy + 40);
  dog.hunger = Math.max(0, dog.hunger - 10);
  log('ç‹—ç‹—ç¡äº†ä¸€è¦ºã€‚');
  afterAction();
}

// --- Mission completion & XP ---
function checkMissionCompletion(){
  // The user requested: 1 "mission" equals feeding >=1 AND playing >=2.
  // But daily missions are randomized; we'll award XP when player's feedDone >=1 AND playDone >=2.
  if (mission.feedDone >= mission.feedTarget && mission.playDone >= mission.playTarget) {
    // award XP once per completion cycle, then generate a new mission
    mission.completedCount++;
    xp += xpPerMission;
    log(`ğŸ‰ ä»»å‹™æ¢ä»¶é”æˆï¼ç²å¾— ${xpPerMission} XPï¼ˆç›®å‰ XP: ${xp}/${xpToLevelUp}ï¼‰`);

    // level up when XP reaches threshold
    if (xp >= xpToLevelUp) {
      xp = 0;
      dog.level++;
      log(`â­ æ­å–œï¼${dog.name || 'ä½ çš„ç‹—ç‹—'} å‡ç´šåˆ° Lv.${dog.level}ï¼`);
    }

    // update displays and start new daily mission (but keep same day until actionCount triggers day change)
    updateMetaUI();
    generateNewMission();
  }
}

// --- Day handling ---
function startNewDay(){
  // æ–°ä¸€å¤©å‹•ç•«æ•ˆæœ
  const gameArea = document.getElementById('gameArea');
  gameArea.classList.add('day-transition');
  setTimeout(()=> gameArea.classList.remove('day-transition'), 800);
  day++;
  actionCount = 0;
  // Optionally, small natural recovery each new day
  // ç¶­æŒå‰ä¸€å¤©çš„å¿«æ¨‚å€¼ï¼Œä¸åšè‡ªå‹•èª¿æ•´
  // æ–°çš„ä¸€å¤©å¿«æ¨‚æ­¸é›¶
  dog.happiness = 0;
  dog.energy = Math.min(100, dog.energy + 10);
  dog.hunger = Math.min(100, dog.hunger + 5);
  log(`ğŸŒ… ç¬¬ ${day} å¤©é–‹å§‹ï¼Œä»»å‹™èˆ‡æ—¥å¸¸ç‹€æ…‹å·²æ›´æ–°ã€‚`);
  generateNewMission();
  updateStatsUI();
  updateMetaUI();
}

// --- Initialization & bindings ---

// dog image selection
let selectedDogImg = "https://place-puppy.com/200x200";

Array.from(document.querySelectorAll('.dogChoice')).forEach(img => {
  img.addEventListener('click', () => {
    selectedDogImg = img.dataset.dog;
    document.querySelectorAll('.dogChoice').forEach(i => i.style.border = "3px solid transparent");
    img.style.border = "3px solid #2563eb";
  });
});
el('startBtn').addEventListener('click', () => {
  const name = el('dogNameInput').value.trim();
  if (!name) { alert('è«‹è¼¸å…¥åå­—ï¼'); return; }
  dog.name = name;
  el('dogTitle').textContent = `${dog.name}`;
  el('namingArea').style.display = 'none';
  el('gameArea').style.display = 'block';
  generateNewMission();
  updateStatsUI();
  updateMetaUI();
  log(`${dog.name} æº–å‚™é–‹å§‹å†’éšªï¼`);
});

el('feedBtn').addEventListener('click', feed);
el('playBtn').addEventListener('click', play);
el('sleepBtn').addEventListener('click', sleepDog);

// initial UI state
updateStatsUI();
updateMissionUI();
updateMetaUI();
</script>
</body>
</html>
