<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pawtopia</title>

<style>
body{
  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
  background: linear-gradient(180deg,#ede9fe,#fdfcff);
  margin:0; padding:16px;
}
.container{
  max-width:1200px; margin:auto; background:white;
  padding:24px; border-radius:20px;
  box-shadow:0 12px 30px rgba(0,0,0,.12);
}
h1{text-align:center;margin:0 0 16px}
.small{font-size:14px;color:#555}

.bar{height:14px;background:#e5e7eb;border-radius:8px;overflow:hidden;margin-top:4px}
.fill{height:100%;background:linear-gradient(90deg,#22c55e,#4ade80);transition:.3s}
button{padding:10px 14px;border:none;border-radius:12px;cursor:pointer;background:#6366f1;color:#fff;font-size:15px}
button:active{transform:scale(.97)}

#namingArea{text-align:center}
#namingArea input{width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;font-size:16px}
.dogChoice{width:90px;height:90px;border-radius:16px;object-fit:cover;cursor:pointer;border:3px solid transparent;transition:.2s}
.dogChoice.selected{border-color:#6366f1;transform:scale(1.08)}

.game-layout{display:grid;grid-template-columns:300px 1fr;gap:20px}
@media(max-width:768px){.game-layout{grid-template-columns:1fr}}

.dog-panel{text-align:center}
.dog-panel img{width:100%;max-width:220px;border-radius:20px}

.stats div{margin-bottom:10px}
.actions{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:12px 0}
.mission li{background:#f8fafc;padding:10px 14px;border-radius:12px;margin-bottom:8px;display:flex;justify-content:space-between}
.log{max-height:160px;overflow-y:auto;}
.log ul{padding-left:16px}

.levelbox{background:#eef2ff;padding:6px 12px;border-radius:10px}
.prop{margin-top:8px;font-size:14px}

/* æ™®é€šå½ˆçª— */
.modal.hidden{display:none}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:999}
.modal-content{background:white;padding:26px;border-radius:20px;max-width:420px;width:90%;text-align:center}

/* å•†åº—å½ˆçª— */
.shop-modal.hidden{display:none}
.shop-modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:1000}
.shop-content{background:white;padding:26px;border-radius:20px;max-width:400px;width:90%;text-align:center}
.shop-content button{width:100%;margin:6px 0;background:#10b981}

/* æœ¨é­šå½ˆçª— */
#woodfish{font-size:64px;cursor:pointer;user-select:none}
#poorModal button{pointer-events:none}

/* å‡åˆ°5ç´šå½ˆçª— */
#level5Modal.hidden{display:none}
#level5Modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:2000}
#level5Modal .modal-content{max-width:500px;width:90%;text-align:center;padding:20px}
#level5Modal img{width:100%;border-radius:20px;margin-bottom:12px}
#level5Modal button{margin:6px;width:45%;font-size:16px;background:#6366f1;color:#fff}
</style>
</head>
<body>

<!-- éŠæˆ²èªªæ˜ -->
<div id="introModal" class="modal hidden">
  <div class="modal-content">
    <h2>ğŸ¶ Pawtopia éŠæˆ²èªªæ˜</h2>
    <p style="line-height:1.7">
      â€¢ æ¯å¤© 7 å€‹ä»»å‹™<br>
      â€¢ ä»»å‹™å®Œæˆå¾Œç²å¾— XP<br>
      â€¢ XP æ»¿ 3 æœƒå‡ç´šä¸¦ç²å¾—é‡‘éŒ¢<br>
      â€¢ è¡Œå‹•éœ€è¦é“å…·ï¼Œå¯åœ¨å•†åº—è³¼è²·<br>
      â€¢ ä¸€å¤©çµæŸå¾Œå¿«æ¨‚å€¼æœƒæ­¸é›¶<br>
      â€¢ ç ´ç”¢æ™‚ï¼Œä¼¼ä¹æœ‰ç¥ç¥•æ–¹å¼å¯ä»¥ç²å¾—è³ºéŒ¢çš„æ©Ÿæœƒâ€¦
    </p>
    <button onclick="closeIntro()">é–‹å§‹éŠæˆ²</button>
  </div>
</div>

<!-- æ–°çš„ä¸€å¤© -->
<div id="newDayModal" class="modal hidden">
  <div class="modal-content">
    <h2 id="newDayText"></h2>
    <button onclick="closeNewDay()">ç¹¼çºŒ</button>
  </div>
</div>

<!-- è­¦å‘Š -->
<div id="warnModal" class="modal hidden">
  <div class="modal-content">
    <h2 id="warnText"></h2>
    <button onclick="closeWarn()">çŸ¥é“äº†</button>
  </div>
</div>

<!-- ç ´ç”¢æœ¨é­š -->
<div id="poorModal" class="modal hidden" style="z-index:1200">
  <div class="modal-content">
    <h2>ä½ çª®çª®çš„ ğŸ˜­</h2>
    <p>ä½ çª®çª®çš„ï¼Œå¿«å¹«è‡ªå·±å’Œå¯æ†çš„åŠ ä¾–ç©é»åŠŸå¾·ï¼</p>
    <div id="woodfish" onclick="knockFish()">ğŸ””</div>
    <p id="fishText">åŠŸå¾·ï¼š<span id="fishCount">0</span>/20</p>
    <button id="closePoorBtn" onclick="closePoor()">é›¢é–‹</button>
  </div>
</div>

<script>
let woodfishLocked = false; // é–å®šé—œé–‰æŒ‰éˆ•
let fish = 0;

function knockFish(){
  fish++; 
  fishCount.textContent = fish;
  if(fish>=20){
    money +=50;
    updateMoney();
    fishText.textContent='åŠŸå¾·åœ“æ»¿ï¼å¤§æ–¹çš„ã„ã„§ã„šã„Œã„¨ã„£ËŠæ±ºå®šåˆ†ä½ ä¸€é»éŒ¢';
    woodfishLocked = false;
    setTimeout(()=>{ poorModal.classList.add('hidden'); },1200);
  }
}

// é—œé–‰æœ¨é­šå½ˆçª—æŒ‰éˆ•ï¼Œå—é™åˆ¶
function closePoor(){
  if(woodfishLocked) return;
  poorModal.classList.add('hidden');
}
</script>

<!-- å•†åº— -->
<div id="shopModal" class="shop-modal hidden">
  <div class="shop-content">
    <h3>å•†åº—</h3>
    <button onclick="buy('food',10)">è³¼è²·é£¼æ–™ $10</button>
    <button onclick="buy('ball',15)">è³¼è²·çƒ $15</button>
    <button onclick="buy('pillow',15)">è³¼è²·æ•é ­ $15</button>
    <button style="background:#ef4444" onclick="closeShop()">é—œé–‰</button>
  </div>
</div>

<!-- å‡åˆ°5ç´š -->
<div id="level5Modal" class="hidden">
  <div class="modal-content">
    <img id="level5Img">
    <h2>è¬è¬ä½ èŠ±æ™‚é–“ç©é€™å€‹çˆ›éŠæˆ²ï¼</h2>
    <button onclick="closeLevel5()">ç¹¼çºŒéŠç©</button>
    <button onclick="exitGame()">é€€å‡ºéŠæˆ²</button>
  </div>
</div>

<div class="container">
<h1>Pawtopiaå°ˆå±¬æ–¼ä½ çš„å°å¥¶ç‹—</h1>

<div id="namingArea">
  <input id="dogNameInput" placeholder="ä½ çš„å¥¶ç‹—å«ä»€éº¼åå­—ï¼Ÿ">
  <div style="display:flex;gap:16px;justify-content:center;margin:16px 0;flex-wrap:wrap">
    <img src="Kiss Me!!!!.jpg" class="dogChoice" data-dog="Kiss Me!!!!.jpg">
    <img src="ä¸‹è¼‰ (2).jpg" class="dogChoice" data-dog="ä¸‹è¼‰ (2).jpg">
    <img src="ä¸‹è¼‰ (3).jpg" class="dogChoice" data-dog="ä¸‹è¼‰ (3).jpg">
  </div>
  <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
</div>

<div id="gameArea" style="display:none">
  <div style="display:flex;justify-content:space-between">
    <div>
      <div id="dogTitle"></div>
      <div id="dayDisplay">ç¬¬ 1 å¤©</div>
    </div>
    <div class="levelbox">Lv <span id="dogLevel">1</span> | XP <span id="xpDisplay">0/3</span> | $<span id="moneyDisplay">50</span></div>
  </div>

  <div class="game-layout">
    <div class="dog-panel">
      <img id="mainDogImg">
      <button style="margin-top:10px;width:100%" onclick="openShop()">ğŸ›’ å•†åº—</button>
    </div>

    <div>
      <div class="stats">
        <div>ğŸ˜Š å¿«æ¨‚ <span id="happyValue">70</span>%<div class="bar"><div id="happyBar" class="fill" style="width:70%"></div></div></div>
        <div>ğŸ– é£½è¶³ <span id="hungerValue">30</span>%<div class="bar"><div id="hungerBar" class="fill" style="width:30%"></div></div></div>
        <div>âš¡ èƒ½é‡ <span id="energyValue">60</span>%<div class="bar"><div id="energyBar" class="fill" style="width:60%"></div></div></div>
      </div>

      <div class="prop">ğŸ¥« <span id="foodCount">5</span> | ğŸ€ <span id="ballCount">5</span> | ğŸ›ï¸ <span id="pillowCount">5</span></div>

      <div class="actions">
        <button onclick="act('é¤µé£Ÿ')">é¤µé£Ÿ</button>
        <button onclick="act('ç©è€')">ç©è€</button>
        <button onclick="act('ç¡è¦º')">ç¡è¦º</button>
      </div>

      <h3>ä»Šæ—¥ä»»å‹™</h3>
      <ul id="missionList"></ul>
      <h3>æ—¥èªŒ</h3>
      <div class="log"><ul id="logList"></ul></div>
    </div>
  </div>
</div>
</div>

<script>
const dog={name:'',happiness:70,hunger:30,energy:60,level:1};
let xp=0, day=1, money=50, fish=0;
let props={food:5,ball:5,pillow:5};
let missions={}, selectedDogImg='',woodfishLocked=false;

const el=id=>document.getElementById(id);
const log=m=>{const li=document.createElement('li');li.textContent=m;el('logList').prepend(li)};

document.querySelectorAll('.dogChoice').forEach(img=>{
  img.onclick=()=>{
    selectedDogImg=img.dataset.dog;
    document.querySelectorAll('.dogChoice').forEach(i=>i.classList.remove('selected'));
    img.classList.add('selected');
  };
});

function startGame(){
  if(!dogNameInput.value||!selectedDogImg){alert('è«‹è¼¸å…¥åå­—ä¸¦é¸æ“‡å¤–è§€');return}
  dog.name=dogNameInput.value;
  dogTitle.textContent=dog.name;
  mainDogImg.src=selectedDogImg;
  namingArea.style.display='none';
  gameArea.style.display='block';
  introModal.classList.remove('hidden');
  generateMissions(); updateStats(); renderProps(); updateMoney(); log('é–‹å§‹å†’éšªï¼');
}

function clamp(){
  dog.happiness=Math.max(0,Math.min(100,dog.happiness));
  dog.hunger=Math.max(0,Math.min(100,dog.hunger));
  dog.energy=Math.max(0,Math.min(100,dog.energy));
}

function updateStats(silent=false){
  clamp();
  happyValue.textContent=dog.happiness;
  hungerValue.textContent=dog.hunger;
  energyValue.textContent=dog.energy;
  happyBar.style.width=dog.happiness+'%';
  hungerBar.style.width=dog.hunger+'%';
  energyBar.style.width=dog.energy+'%';

  if(!silent){
    if(dog.happiness<=10) warn('âš ï¸ ç‹—ç‹—å¿«æ¨‚å¤ªä½äº†ï¼');
    else if(dog.hunger<=10) warn('âš ï¸ ç‹—ç‹—å¤ªé¤“äº†ï¼');
    else if(dog.energy<=10) warn('âš ï¸ ç‹—ç‹—æ²’æœ‰åŠ›æ°£äº†ï¼');
  }
}

function renderProps(){foodCount.textContent=props.food;ballCount.textContent=props.ball;pillowCount.textContent=props.pillow}
function updateMoney(){moneyDisplay.textContent=money}

function closeIntro(){introModal.classList.add('hidden')}
function openShop(){shopModal.classList.remove('hidden')}
function closeShop(){shopModal.classList.add('hidden')}
function closePoor(){if(fish<20)return; poorModal.classList.add('hidden')}
function closeLevel5(){level5Modal.classList.add('hidden')}
function exitGame(){window.location.reload()}
function warn(t){warnText.textContent=t;warnModal.classList.remove('hidden')}
function closeWarn(){warnModal.classList.add('hidden')}

function buy(item,cost){
  if(money<cost){
    fish=0; fishCount.textContent=0; fishText.textContent='åŠŸå¾·ï¼š0/20';
    poorModal.classList.remove('hidden'); woodfishLocked=true; return;
  }
  props[item]++; money-=cost; renderProps(); updateMoney(); log('è³¼è²·é“å…·');
}

function knockFish(){
  fish++; fishCount.textContent=fish;
  if(fish>=20){
    money+=50; updateMoney();
    fishText.textContent='åŠŸå¾·åœ“æ»¿ï¼å¤§æ–¹çš„ã„ã„§ã„šã„Œã„¨ã„£ËŠæ±ºå®šåˆ†ä½ ä¸€é»éŒ¢';
    woodfishLocked=false;
    setTimeout(()=>{ poorModal.classList.add('hidden'); },1200);
  }
}

document.querySelector('#poorModal button').onclick=()=>{ if(!woodfishLocked) closePoor() };

function generateMissions(){
  missions={é¤µé£Ÿ:{d:0,t:0},ç©è€:{d:0,t:0},ç¡è¦º:{d:0,t:0}};
  let r=7;
  while(r>0){
    const k=Object.keys(missions)[Math.floor(Math.random()*3)];
    if(missions[k].t<3){missions[k].t++; r--;}
  }
  renderMissions();
}

function renderMissions(){
  missionList.innerHTML='';
  for(const k in missions){
    const m=missions[k];
    const li=document.createElement('li');
    li.innerHTML=`${k} <span>${m.d}/${m.t}</span>`;
    missionList.appendChild(li);
  }
}

function act(t){
  if((t==='é¤µé£Ÿ'&&props.food<=0)||(t==='ç©è€'&&props.ball<=0)||(t==='ç¡è¦º'&&props.pillow<=0)){alert('é“å…·ä¸è¶³');return}

  if(t==='é¤µé£Ÿ'){props.food--;dog.hunger+=20;dog.happiness+=5}
  if(t==='ç©è€'){props.ball--;dog.happiness+=15;dog.energy-=15;dog.hunger-=10}
  if(t==='ç¡è¦º'){props.pillow--;dog.energy+=30;dog.happiness-=10;dog.hunger-=15}

  if(missions[t].d<missions[t].t){
    missions[t].d++;
    if(missions[t].d===missions[t].t){
      xp++; log('å®Œæˆä»»å‹™ +1 XP');
      if(xp>=3){
        xp=0; dog.level++; money+=10; dogLevel.textContent=dog.level; updateMoney();
        if(dog.level===5){
          level5Img.src=selectedDogImg;
          level5Modal.classList.remove('hidden');
        }
      }
    }
  }

  updateStats(); renderProps(); renderMissions(); xpDisplay.textContent=`${xp}/3`; log(t+' è¡Œå‹•');
  if(Object.values(missions).every(m=>m.d>=m.t)) newDay();
}

function newDay(){
  day++; dayDisplay.textContent='ç¬¬ '+day+' å¤©';
  newDayText.textContent='ğŸŒ… ç¬¬ '+day+' å¤©é–‹å§‹ï¼';
  newDayModal.classList.remove('hidden');
  generateMissions();
}

function closeNewDay(){
  newDayModal.classList.add('hidden');
  dog.happiness=0; updateStats(true); // silent true, ä¸è§¸ç™¼è­¦å‘Š
}
</script>
</body>
</html>
